var ajaxurl=meta_image.ajaxurl,user={onReady:function(){user.imageUploader(),user.carouselImageUploader(),user.removeItem(),user.removeImage(),user.removeVideo(),user.selectTabPage(),user.sectionBtn()},imageUploader:function(){var e;jQuery(".upload-image").click(function(t){t.preventDefault();var a=jQuery(this),r=a.parent(),o=r.attr("data-img"),u=r.attr("data-input"),n=r.attr("data-post");e=wp.media.frames.meta_image_frame=wp.media({title:meta_image.title,button:{text:meta_image.button},library:{type:"image, video"},multiple:!0}),e.open(),e.on("select",function(){var t=e.state().get("selection").first().toJSON();"bg_video"===o?(a.parent().append('<video muted autoplay id="bgvid" loop><source src="'+t.url+'" type="video/webm"><source src="'+t.url+'" type="video/ogv"><source src="'+t.url+'" type="video/mp4"></video>'),jQuery("#"+u).val(t.url),a.parent().append('<span class="button button-remove remove-video">X</span>'),a.remove(),user.saveFeaturedVideo(n,t.url)):(a.parent().append('<img src="'+t.url+'" alt="" />'),jQuery("input",r).val(t.url),a.remove(),"section"!==o&&(a.parent().append('<a href="#" class="button-remove remove-image">Remove icon</a>'),user.saveImage(n,u,t.url)))})})},removeVideo:function(){jQuery(".remove-video").click(function(e){e.preventDefault();var t=jQuery(this).parent().attr("data-img"),a=jQuery(this).parent().attr("data-post");jQuery("."+t).html(""),jQuery("#custom_"+t).val(""),jQuery(".bg_video").append('<a href="" class="upload-image upload-banner">Set featured video</a>'),jQuery(this).remove(),user.saveFeaturedVideo(a,""),user.imageUploader()})},removeImage:function(){jQuery(".remove-image").click(function(e){e.preventDefault();var t=jQuery(this).parent().attr("data-input"),a=jQuery(this).parent().attr("data-post"),r=jQuery(this).attr("data-text");jQuery(this).parent().find("input").val(""),jQuery(this).parent().find("img").remove(),user.saveImage(a,t,""),jQuery(this).parent().append('<a class="upload-image" data-input="'+t+'" data-post="'+a+'">Upload/Set '+r+"</a>"),jQuery(this).remove(),user.imageUploader()})},saveImage:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{imageField:t,fieldVal:a,postID:e,action:"setImage"},dataType:"html",success:function(){user.removeImage()},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},carouselImageUploader:function(){var e;jQuery(".upload-carousel").click(function(t){t.preventDefault();var a=jQuery(this),r=jQuery(this).parent().attr("data-post"),o=jQuery(this).parent().attr("data-type"),u=jQuery(".photoWrap").children().length,n=jQuery(this).hasClass("upload-photo"),i=jQuery(this).hasClass("upload-screencast"),s=jQuery(this).hasClass("upload-banner"),l=jQuery(this).hasClass("upload-section");e=wp.media.frames.meta_image_frame=wp.media({title:meta_image.title,button:{text:meta_image.button},library:{type:"image, video"},multiple:!1}),e.open(),e.on("select",function(){var t=e.state().get("selection").first().toJSON();jQuery(".photoWrap").append('<li class="photo ui-state-default" data-order="'+u+'"><img src="'+t.url+'" alt="" /><span class="button button-remove remove-photo">X</span></li>'),user.saveCarouselImage(r,o,t.url),e.close()})})},saveCarouselImage:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{postID:e,type:t,fieldVal:a,action:"setCarouselImage"},dataType:"html",success:function(){user.removeItem(),jQuery(".banner-image").remove()},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},removeItem:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"removeItem",postID:e,type:a,key:t},dataType:"html",error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}}),jQuery(".button-remove").click(function(e){e.preventDefault();var t=jQuery(this).parent().parent().attr("data-post"),a=jQuery(this).parent().parent().attr("data-type"),r=jQuery(this).parent().attr("data-key");jQuery(this).parent().remove(),user.removeItem(t,r,a),user.carouselImageUploader()})},saveFeaturedVideo:function(e,t){jQuery.ajax({url:ajaxurl,type:"GET",data:{fieldVal:t,postID:e,action:"setVideo"},dataType:"html",success:function(){user.removeVideo()},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},selectTabPage:function(){jQuery(".copy select").change(function(){var e=jQuery(this).parent().parent().attr("data-tab");console.log(e),jQuery("#section3_tab"+e+"_page").val(this.value)})},addSection:function(e){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"addSection",count:e},dataType:"html",success:function(e){jQuery("#sectionWrap").append(e)},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)},complete:function(){user.imageUploader(),user.sectionRemove()}})},addCheckoutPerk:function(e){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"addCheckoutPerk",count:e},dataType:"html",success:function(e){jQuery("#sectionWrap").append(e)},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)},complete:function(){user.imageUploader(),user.sectionRemove()}})},removeSection:function(){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"removeSection"},dataType:"html",error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},sectionBtn:function(){jQuery(".btn-section").click(function(e){var t=jQuery("#sectionWrap section").length;e.preventDefault(),user.addSection(t)}),jQuery(".btn-checkout").click(function(e){var t=jQuery("#sectionWrap section").length;e.preventDefault(),user.addCheckoutPerk(t)}),jQuery(".remove_section").click(function(){jQuery(this).parent().parent().remove()})}};jQuery(document).ready(function(){user.onReady()});